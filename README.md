# Exploring Diagnostic Methodology for Pulmonary Edema Diagnosis in Patients with Congestive Heart Failure Using U-Net Based Architecture

### U-Net ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¥¼ í™œìš©í•œ ìš¸í˜ˆì„± ì‹¬ë¶€ì „ í™˜ì íë¶€ì¢… ì§„ë‹¨ ë°©ë²•ë¡  ì—°êµ¬

#### <div align="center"><b><a href="">â­ í•œêµ­ì •ë³´í†µì‹ í•™íšŒ JKIICE ë…¼ë¬¸ ì‹¬ì‚¬ ì¤‘ â­</a></b></div>

- ë§í¬ ì¶”ê°€ ì˜ˆì •

## ğŸ“ Project Description

[ğŸ“Œ Doby's Lab (BLOG): U-Net ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¥¼ í™œìš©í•œ ìš¸í˜ˆì„± ì‹¬ë¶€ì „ í™˜ì íë¶€ì¢… ì§„ë‹¨ ë°©ë²•ë¡  ì—°êµ¬]()

- ì¶”í›„ ì¶”ê°€ ì˜ˆì •

## ğŸƒâ€â™‚ï¸ Motivation, OMS (One-Man Show Project)

> ë³¸ ì—°êµ¬ í”„ë¡œì íŠ¸ ë° ë…¼ë¬¸ íˆ¬ê³ ì˜ ë™ê¸°ëŠ” ì§€ë‚œ í•´ ë³µí•™í•˜ì—¬ ëŒì•„ì˜¨ í•™ê¸°ë¶€í„° ë¹„ë¡¯ëœ ë¶ˆì•ˆì—ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
>
> ìƒê°ì˜ ê¼¬ë¦¬ë¥¼ ë¬¼ê³  ë¬¼ì–´ <b><u>'ë‚œ ì—°êµ¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒì¼ê¹Œ?'</u></b>ë¼ëŠ” ì˜ë¬¸ì´ ë“¤ì—ˆê³ , ê²°ë¡ ì ìœ¼ë¡œ ì´ë¥¼ í•´ì†Œí•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì—°êµ¬ì˜ ì‹œì‘ë¶€í„° ëê¹Œì§€ ì§ì ‘ í•´ë³´ëŠ” ê²ƒ ë°–ì— ì—†ê² ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.
>
> ìŠ¤ìŠ¤ë¡œ (1)í”„ë¡œì íŠ¸ì˜ ì•„ì´ë””ì–´, (2)êµ¬í˜„ ë° ì‹¤í—˜, (3)ë…¼ë¬¸ ì‘ì„±ê¹Œì§€ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ë“¤ì„ ê²ªì–´ë³´ëŠ” ê²ƒì„ í†µí•´ ìì‹ ì—ê²Œ ì¦ëª…ì„ í•´ì£¼ê³  ì‹¶ì—ˆë˜ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.
>
> ê·¸ë˜ì„œ ì´ í”„ë¡œì íŠ¸ì˜ ì´ë¦„ì„ ì €ëŠ” <b><u>OMS(One-Man Show)</u></b>ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì§“ê³ ì„œ í”„ë¡œì íŠ¸ë¥¼ í•˜ëŠ” ë™ì•ˆ ë‹¤ì‹œ í˜¼ìê°€ ë˜ì–´ í˜ê» ë…¸ë¥¼ ì €ì—ˆìŠµë‹ˆë‹¤.
>
> ë¬¼ë¡ , ì•„ì§ê¹Œì§€ ì§ì ‘ ì—°êµ¬ì‹¤ì— ë“¤ì–´ê°€ì„œ ì—°êµ¬ë¥¼ ë°°ìš°ê³ , í•´ë³¸ ì ì€ ì—†ê¸°ì— ì œê°€ í•¨ë¶€ë¡œ ì—°êµ¬ë¥¼ í•´ë´¤ë‹¤ê³  ë§í•˜ëŠ” ê²ƒì€ ì˜¤ë§Œí•œ ê²ƒì´ë¼ëŠ” ìƒê°ì´ ë“­ë‹ˆë‹¤.
>
> ë‹¤ë§Œ, ì´ë²ˆ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ì•ìœ¼ë¡œ ë” ë°°ì›Œë‚˜ê°€ì•¼í•  ê²ƒë“¤, ì´ˆì ì„ ë‘ì–´ì•¼ í•  ê³³ë“¤ì´ ë¬´ì—‡ì¸ì§€ ëª…í™•íˆ ì•Œì•˜ê¸°ì— ë” ê²¸ì†í•œ ìì„¸ë¡œ í—¤ì³ë‚˜ê°€ê² ìŠµë‹ˆë‹¤.
>
> ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ì§§ê³  ê¸¸ì—ˆë˜ OMS í”„ë¡œì íŠ¸ë¥¼ ë§ˆì¹˜ë©°.

## ğŸ“ Dataset

1. <a href="https://physionet.org/content/mimic-cxr-jpg/2.0.0/">MIMIC-CXR-JPG - chest radiographs with structured labels</a>
2. <a href="https://physionet.org/content/chest-x-ray-segmentation/1.0.0/">Chest X-ray Dataset with Lung Segmentation v1.0.0</a>
3. <a href="https://physionet.org/content/mimic-cxr-pe-severity/1.0.1/">Pulmonary Edema Severity Grades Based on MIMIC-CXR v1.0.1</a>

## ğŸ’¡ Research IDEA and GOAL

- ë³¸ ì—°êµ¬ì˜ ì•„ì´ë””ì–´ ê¸°ë°˜ì´ ë˜ì—ˆë˜ ë‡Œì¢…ì–‘ì„ Segmentationí•˜ëŠ” ì—°êµ¬, <a href="https://ieeexplore.ieee.org/document/9199562">TSTBS</a>ì—ì„œëŠ” <u><b>ì˜ë£Œì§„ì˜ ì§„ë‹¨ ê³¼ì •</b></u>ì— ì°©ì•ˆí•˜ì—¬ ì•„í‚¤í…ì²˜ë¥¼ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì— ë”°ë¼ Chest X-rayë¥¼ í†µí•´ Congestive Heart Failure(ìš¸í˜ˆì„± ì‹¬ë¶€ì „) í™˜ìë“¤ì˜ Pulmonary Edema(íë¶€ì¢…) ì§„ë‹¨ì„ í•  ë•Œ, ì˜ë£Œì§„ì˜ ì§„ë‹¨ ê³¼ì •ì— ì°©ì•ˆí•˜ì—¬ í ì˜ì—­ì— ëŒ€í•œ ì§‘ì¤‘ë„ë¥¼ ë†’ì´ê³ ì Semantic Segmentationì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ë¶„í• ëœ í ì˜ì—­ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ í™œìš©í•œ ë¶„ë¥˜ ì‹¤í—˜ 3ê°€ì§€ì™€ ê·¸ë ‡ì§€ ì•Šì€ ë¶„ë¥˜ ì‹¤í—˜ 2ê°€ì§€ë¥¼ ì§„í–‰í•˜ì—¬ ì„±ëŠ¥ì„ ë¹„êµí•œ ê²°ê³¼, <u><b>í ì˜ì—­ì— ëŒ€í•´ ê³ ë ¤í•œ ì‹¤í—˜ì´ ì„±ëŠ¥ì´ ë” ìš°ìˆ˜í•˜ë‹¤</b></u>ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ’» Summary using <code>Streamlit</code>

<code>streamlit</code>ì„ í†µí•´ êµ¬í˜„í•œ ì›¹ìœ¼ë¡œ í”„ë¡œì íŠ¸ì˜ ì „ë°˜ì ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ìš”ì•½í•©ë‹ˆë‹¤.

![streamlit_gif](./streamlit/oms_streamlit.gif)

## 1ï¸âƒ£ Segmentation Task

- Lung Segementationì„ ìˆ˜í–‰í•˜ëŠ” ê°€ì¥ ì í•©í•œ ëª¨ë¸ì„ ì°¾ê¸° ìœ„í•´ <u><b>U-Net, SA U-Net, U-Net++</b></u> ì•„í‚¤í…ì²˜ë¥¼ í•™ìŠµí•˜ì—¬ ì„±ëŠ¥ì„ ë¹„êµí•˜ì˜€ìŠµë‹ˆë‹¤.
- Segmentation Taskì˜ ê²½ìš°ì—ëŠ” PyTorchì˜ í™œìš©ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ì„œ ì„¸ ì•„í‚¤í…ì²˜ ëª¨ë‘ ì§ì ‘ êµ¬í˜„í•˜ì—¬ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

### ğŸ“„ U-Net based Architectures Repositories

1. <a href="">U-Net Implementation Repository</a>
2. <a href="">SA U-Net Implementation Repository</a>
3. <a href="">U-Net++ Implementation Repositiory</a>

### ğŸ“„ Train Setting

- Loss functionì€ Semantic segmentationì—ì„œ ë³´í¸ì ìœ¼ë¡œ ì“°ì´ëŠ” <b>Dice Loss</b>ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
  $$DiceLoss = \frac{2\times(|A|\cap|B|)}{|A|+|B|}$$
- ì¢…í•©ì ì¸ í•™ìŠµ ìŠ¤í™ì€ ëª¨ë‘ ë™ì¼í•˜ê²Œ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

|  Loss function   |  Opimizer   | Learning rate | Decay step | Decay rate |   Activation   |  Epochs   |
| :--------------: | :---------: | :-----------: | :--------: | :--------: | :------------: | :-------: |
| <u>Dice Loss</u> | <u>Adam</u> |  <u>1e-4</u>  |  <u>5</u>  | <u>0.1</u> | <u>Sigmoid</u> | <u>50</u> |

### ğŸ“„ Performance Table

- ìœ„ì™€ ê°™ì€ ì„¸íŒ…ì„ í†µí•´ í•™ìŠµì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
- SA U-Netì€ DropBlockì˜ ì‚¬ì´ì¦ˆì— ë”°ë¼ 2ê°œì˜ í•™ìŠµì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.
  - DropBlock 10% - ì „ì²´ ì´ë¯¸ì§€ì˜ 10%ë¥¼ Drop
  - DropBlock 10% - ì „ì²´ ì´ë¯¸ì§€ì˜ 10%ë¥¼ Drop
- U-Net++ëŠ” 2ê°€ì§€ Modeì— ë”°ë¼ í•™ìŠµì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.
  - Fast mode
  - Accurate mode

|        Model        |       Accuracy       |       F1-Score       |         AUC          |         MCC          |
| :-----------------: | :------------------: | :------------------: | :------------------: | :------------------: |
| <u><b>U-Net</b></u> | <u><b>94.67%</b></u> | <u><b>0.9808</b></u> | <u><b>0.9749</b></u> | <u><b>0.9729</b></u> |
|   SA U-Net (10%)    |        93.98%        |        0.9684        |        0.9695        |        0.9554        |
|   SA U-Net (20%)    |        93.85%        |        0.9660        |        0.9613        |        0.9521        |
|   U-Net++ (fast)    |        94.60%        |        0.9795        |        0.9720        |        0.9711        |
| U-Net++ (accurate)  |        94.59%        |        0.9793        |        0.9722        |        0.9708        |

### ğŸ“„ Result

- í•™ìŠµ ê²°ê³¼ Segmentation Taskì—ì„œëŠ” <u><b>U-Net</b></u>ì„ ì‚¬ìš©í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
- Epochê°€ ë” ì»¸ë‹¤ë©´, ë‹¤ë¥¸ ëª¨ë¸ë“¤ì´ ë” ì„±ëŠ¥ì´ ë†’ì•˜ì„ ê²ƒìœ¼ë¡œ ì¶”ì¸¡í•˜ê³  ìˆìŠµë‹ˆë‹¤.

## 2ï¸âƒ£ 5 Data Processing Methods

> ë³¸ ë‹¨ë½ì—ì„œëŠ” Segmentation Task ì´í›„ì— ì–»ì€ ë°ì´í„°ë¥¼ í™œìš©í•œ <u>3ê°€ì§€ Method</u>ì™€ ê·¸ë ‡ì§€ ì•Šì€ <u>2ê°€ì§€ Method</u>ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.

![methods_figure](./figures/figure6_resize.jpg)

### ğŸ©º <i>Experient 1</i>

- ì›ë³¸ ì´ë¯¸ì§€ì— ëŒ€í•´ì„œëŠ” <b>ê°€ìš°ì‹œì•ˆ í•„í„°ë§(Gaussian Filtering)</b>ì„ ì ìš©í•˜ê³ , í ì˜ì—­ ì´ë¯¸ì§€ì™€ ë¸”ëœë”©ì„ í•˜ëŠ” Methodì…ë‹ˆë‹¤.
- ê°€ìš°ì‹œì•ˆ í•„í„°ë§ì€ ë¹„ì „ ë¶„ì•¼ì—ì„œ ë…¸ì´ì¦ˆ ì œê±° íš¨ê³¼ë¥¼ í•˜ê³  ìˆìœ¼ë©°, ê°€ìš°ì‹œì•ˆ ë¶„í¬ì— ë”°ë¼ ì¤‘ì‹¬ í”½ì…€ë¡œë¶€í„° ë©€ì–´ì§ˆìˆ˜ë¡ ê°€ì¤‘ì¹˜ë¥¼ ì ê²Œì£¼ëŠ” ì—­í• ì„ í•˜ì—¬ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
  $$ G(x,y)=\frac{1}{2\pi\sigma}e^{-\frac{x^2+y^2}{2\sigma^2}}$$
- <b>ì´ë¯¸ì§€ ë¸”ëœë”©(Image Blending)</b>ì€ ë‘ ì´ë¯¸ì§€ë¥¼ ì„œë¡œ í•©ì¹  ë•Œ, ê°€ì¤‘ì¹˜ë¥¼ í†µí•´ í•©ì¹˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.
  $$ g(x)=(1-\alpha)f_1(x)+\alpha f_2(x)$$
- í•´ë‹¹ Methodë¥¼ ì ìš©í•œ figureëŠ” 1ë²ˆì§¸ì™€ ê°™ìŠµë‹ˆë‹¤.

### ğŸ©º <i>Experiment 2</i>

### ğŸ©º <i>Experiment 3</i>

### ğŸ©º <i>Experiment 4</i>

### ğŸ©º <i>Experiment 5</i>

## 3ï¸âƒ£ Classification Task

## âœ… Conclusion

## â›” .gitignore
